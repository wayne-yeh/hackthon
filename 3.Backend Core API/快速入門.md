# TAR Backend Core API - å¿«é€Ÿå…¥é–€

## ç°¡ä»‹

é€™æ˜¯ Tokenized Asset Receipt (TAR) ç³»çµ±çš„æ ¸å¿ƒå¾Œç«¯ API æœå‹™ï¼Œè² è²¬å”èª¿æ•´å€‹æ”¶æ“šç”Ÿå‘½é€±æœŸï¼šå…ƒæ•¸æ“šä¸Šå‚³ã€NFT é‘„é€ å’Œé©—è­‰ã€‚

## ç³»çµ±éœ€æ±‚

- Java 17 æˆ–æ›´é«˜ç‰ˆæœ¬
- Maven 3.6+ (æˆ–ä½¿ç”¨å…§å»ºçš„ Maven Wrapper)
- Docker & Docker Compose (ç”¨æ–¼å®¹å™¨åŒ–éƒ¨ç½²)
- PostgreSQL 14+ (ç”¨æ–¼æœ¬åœ°é–‹ç™¼)
- é‹è¡Œä¸­çš„å€å¡Šéˆç¯€é» (Hardhat, Sepolia ç­‰)
- é‹è¡Œä¸­çš„ Metadata Service

## å¿«é€Ÿå•Ÿå‹•

### 1. ç’°å¢ƒè¨­ç½®

```bash
# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
cp .env.sample .env

# ç·¨è¼¯ç’°å¢ƒè®Šæ•¸
nano .env
```

é…ç½®ä»¥ä¸‹é—œéµåƒæ•¸ï¼š

```env
# è³‡æ–™åº«é…ç½®
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=tar_backend
POSTGRES_USER=taruser
POSTGRES_PASSWORD=your-password

# å€å¡Šéˆé…ç½®
BLOCKCHAIN_RPC_URL=http://localhost:8545
CONTRACT_ADDRESS=0x5FbDB2315678afecb367f032d93F642f64180aa3
ISSUER_PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

# Metadata Service é…ç½®
METADATA_SERVICE_URL=http://localhost:8081

# API å¯†é‘°
API_KEY_SECRET=change-this-in-production
```

### 2. ä½¿ç”¨ Docker å•Ÿå‹•ï¼ˆæ¨è–¦ï¼‰

```bash
# æ§‹å»ºä¸¦å•Ÿå‹•æ‰€æœ‰æœå‹™
make docker-up

# æŸ¥çœ‹æ—¥èªŒ
make docker-logs

# åœæ­¢æœå‹™
make docker-down
```

æœå‹™å•Ÿå‹•å¾Œå¯è¨ªå•ï¼š

- API: http://localhost:8080
- Swagger UI: http://localhost:8080/swagger-ui.html
- å¥åº·æª¢æŸ¥: http://localhost:8080/actuator/health

### 3. æœ¬åœ°é‹è¡Œï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰

```bash
# å®‰è£ Maven Wrapper
make setup

# æ§‹å»ºæ‡‰ç”¨
make build

# é‹è¡Œæ¸¬è©¦
make test

# å•Ÿå‹•æ‡‰ç”¨
make run
```

## API ä½¿ç”¨ç¯„ä¾‹

### 1. ç™¼è¡Œæ”¶æ“š

```bash
curl -X POST http://localhost:8080/api/v1/receipts/issue \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key-secret" \
  -d '{
    "invoiceNo": "INV-2024-001",
    "purchaseDate": "2024-01-15",
    "amount": 1000.00,
    "itemName": "MacBook Pro 16å‹",
    "ownerAddress": "0x1234567890123456789012345678901234567890"
  }'
```

### 2. é©—è­‰æ”¶æ“š

```bash
curl -X POST http://localhost:8080/api/v1/receipts/verify \
  -H "Content-Type: application/json" \
  -d '{
    "tokenId": 1,
    "metadataHash": "0xabcdef..."
  }'
```

### 3. æŸ¥è©¢æ”¶æ“šè©³æƒ…

```bash
curl http://localhost:8080/api/v1/receipts/1/details
```

### 4. æ’¤éŠ·æ”¶æ“š

```bash
curl -X POST http://localhost:8080/api/v1/receipts/1/revoke \
  -H "X-API-Key: your-api-key-secret"
```

## æ¸¬è©¦

### é‹è¡Œæ‰€æœ‰æ¸¬è©¦

```bash
make test
```

### ç”Ÿæˆæ¸¬è©¦è¦†è“‹ç‡å ±å‘Š

```bash
make coverage
# åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹ target/site/jacoco/index.html
```

### é‹è¡Œç¯„ä¾‹è«‹æ±‚

```bash
# åŸ·è¡Œç¯„ä¾‹è«‹æ±‚è…³æœ¬
./scripts/example-requests.sh
```

## API æ–‡æª”

### Swagger UIï¼ˆäº’å‹•å¼æ–‡æª”ï¼‰

```
http://localhost:8080/swagger-ui.html
```

### OpenAPI è¦ç¯„

```
http://localhost:8080/api-docs
```

## ä¸»è¦ç«¯é»

| ç«¯é»                                      | æ–¹æ³• | èªè­‰ | æè¿°                 |
| ----------------------------------------- | ---- | ---- | -------------------- |
| `/api/v1/receipts/issue`                  | POST | éœ€è¦ | ç™¼è¡Œæ–°æ”¶æ“š           |
| `/api/v1/receipts/verify`                 | POST | å…¬é–‹ | é©—è­‰æ”¶æ“š             |
| `/api/v1/receipts/{tokenId}/revoke`       | POST | éœ€è¦ | æ’¤éŠ·æ”¶æ“š             |
| `/api/v1/receipts/{tokenId}/details`      | GET  | å…¬é–‹ | æŸ¥è©¢æ”¶æ“šè©³æƒ…         |
| `/api/v1/receipts/owner/{address}`        | GET  | éœ€è¦ | æŸ¥è©¢æ“æœ‰è€…çš„æ‰€æœ‰æ”¶æ“š |
| `/api/v1/receipts/owner/{address}/active` | GET  | éœ€è¦ | æŸ¥è©¢æ“æœ‰è€…çš„æœ‰æ•ˆæ”¶æ“š |

## é …ç›®çµæ§‹

```
src/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ java/com/tar/backend/
â”‚   â”‚   â”œâ”€â”€ BackendCoreApplication.java    # ä¸»æ‡‰ç”¨é¡
â”‚   â”‚   â”œâ”€â”€ config/                        # é…ç½®é¡
â”‚   â”‚   â”œâ”€â”€ controller/                    # REST æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ dto/                          # æ•¸æ“šå‚³è¼¸å°è±¡
â”‚   â”‚   â”œâ”€â”€ entity/                       # JPA å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ repository/                   # æ•¸æ“šè¨ªå•å±¤
â”‚   â”‚   â””â”€â”€ service/                      # æ¥­å‹™é‚è¼¯å±¤
â”‚   â””â”€â”€ resources/
â”‚       â””â”€â”€ application.yml               # æ‡‰ç”¨é…ç½®
â””â”€â”€ test/                                 # æ¸¬è©¦ä»£ç¢¼
```

## å¸¸è¦‹å•é¡Œ

### 1. ç„¡æ³•é€£æ¥åˆ° PostgreSQL

```bash
# æª¢æŸ¥ PostgreSQL æ˜¯å¦é‹è¡Œ
docker-compose ps postgres

# æŸ¥çœ‹ PostgreSQL æ—¥èªŒ
docker-compose logs postgres
```

### 2. ç„¡æ³•é€£æ¥åˆ° Metadata Service

```bash
# é©—è­‰ Metadata Service æ˜¯å¦å¯è¨ªå•
curl http://localhost:8081/actuator/health
```

### 3. å€å¡Šéˆé€£æ¥éŒ¯èª¤

```bash
# æª¢æŸ¥å€å¡Šéˆç¯€é»æ˜¯å¦é‹è¡Œ
curl -X POST http://localhost:8545 \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
```

### 4. æ¸¬è©¦å¤±æ•—

```bash
# æ¸…ç†ä¸¦é‡æ–°æ§‹å»º
make clean build test
```

## é–‹ç™¼å·¥ä½œæµç¨‹

1. **å¯«æ¸¬è©¦** (TDD æ–¹æ³•)

   ```bash
   # ç·¨å¯«å¤±æ•—çš„æ¸¬è©¦
   nano src/test/java/com/tar/backend/...

   # é‹è¡Œæ¸¬è©¦ç¢ºèªå¤±æ•—
   make test
   ```

2. **å¯¦ç¾åŠŸèƒ½**

   ```bash
   # å¯¦ç¾ä»£ç¢¼ä½¿æ¸¬è©¦é€šé
   nano src/main/java/com/tar/backend/...

   # å†æ¬¡é‹è¡Œæ¸¬è©¦
   make test
   ```

3. **æª¢æŸ¥è¦†è“‹ç‡**
   ```bash
   make coverage
   ```

## éƒ¨ç½²

### Docker éƒ¨ç½²

```bash
# æ§‹å»º Docker æ˜ åƒ
make docker-build

# ä½¿ç”¨ docker-compose éƒ¨ç½²
make docker-up
```

### å¥åº·æª¢æŸ¥

```bash
# æ‡‰ç”¨å¥åº·ç‹€æ…‹
curl http://localhost:8080/actuator/health

# è©³ç´°å¥åº·ä¿¡æ¯ï¼ˆéœ€è¦èªè­‰ï¼‰
curl -u admin:password http://localhost:8080/actuator/health
```

## å®‰å…¨æ³¨æ„äº‹é …

- ğŸ”‘ **ç§é‘°**: çµ•ä¸å°‡ç§é‘°æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ğŸ›¡ï¸ **API å¯†é‘°**: å®šæœŸè¼ªæ› API å¯†é‘°
- ğŸ”’ **è³‡æ–™åº«**: ä½¿ç”¨å¼·å¯†ç¢¼ä¸¦é™åˆ¶è¨ªå•
- ğŸŒ **CORS**: åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­é…ç½®å…è¨±çš„ä¾†æº
- ğŸ“ **æ—¥èªŒ**: é¿å…è¨˜éŒ„æ•æ„Ÿæ•¸æ“š

## æ€§èƒ½å„ªåŒ–

- **ç·©å­˜**: å•Ÿç”¨ Spring Cache ç”¨æ–¼é »ç¹è¨ªå•çš„æ•¸æ“š
- **é€£æ¥æ± **: ä½¿ç”¨ HikariCP é€²è¡Œæ•¸æ“šåº«é€£æ¥æ± ç®¡ç†
- **éåŒæ­¥è™•ç†**: ä½¿ç”¨éåŒæ­¥æ“ä½œé€²è¡Œéé˜»å¡ I/O
- **ç´¢å¼•**: åœ¨é »ç¹æŸ¥è©¢çš„å­—æ®µä¸Šå»ºç«‹æ•¸æ“šåº«ç´¢å¼•

## ç›£æ§

å¯è¨ªå• Actuator ç«¯é»ï¼š

- å¥åº·ç‹€æ…‹: `/actuator/health`
- æ‡‰ç”¨ä¿¡æ¯: `/actuator/info`
- æŒ‡æ¨™æ•¸æ“š: `/actuator/metrics`

## æ”¯æ´

å¦‚æœ‰å•é¡Œæˆ–éœ€è¦å¹«åŠ©ï¼š

- æŸ¥é–± README.md ç²å–è©³ç´°æ–‡æª”
- æŸ¥é–± API_DOCUMENTATION.md ç²å– API è©³æƒ…
- è¨ªå• Swagger UI: http://localhost:8080/swagger-ui.html

## ä¸‹ä¸€æ­¥

1. âœ… é…ç½®ç’°å¢ƒè®Šæ•¸
2. âœ… å•Ÿå‹•æœå‹™
3. âœ… æ¸¬è©¦ API ç«¯é»
4. ğŸ“± æ•´åˆå‰ç«¯ DApp
5. ğŸ” è¨­ç½® Verification Service
6. ğŸš€ éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ

## Make å‘½ä»¤åƒè€ƒ

| å‘½ä»¤                | æè¿°               |
| ------------------- | ------------------ |
| `make help`         | é¡¯ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤   |
| `make build`        | æ§‹å»ºæ‡‰ç”¨           |
| `make test`         | é‹è¡Œæ¸¬è©¦           |
| `make run`          | æœ¬åœ°é‹è¡Œæ‡‰ç”¨       |
| `make clean`        | æ¸…ç†æ§‹å»ºç”¢ç‰©       |
| `make docker-build` | æ§‹å»º Docker æ˜ åƒ   |
| `make docker-up`    | å•Ÿå‹• Docker å®¹å™¨   |
| `make docker-down`  | åœæ­¢ Docker å®¹å™¨   |
| `make coverage`     | ç”Ÿæˆæ¸¬è©¦è¦†è“‹ç‡å ±å‘Š |
| `make swagger`      | æ‰“é–‹ Swagger UI    |
