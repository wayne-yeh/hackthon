# TAR 元數據服務 - 快速入門指南

## 🚀 5 分鐘快速開始

### 步驟 1: 環境準備

```bash
# 進入專案目錄
cd "2.Metadata Service"

# 檢查 Java 版本 (需要 Java 17+)
java -version

# 檢查 Maven 版本
mvn -version
```

### 步驟 2: 運行測試

```bash
# 運行所有測試
mvn test

# 運行測試並生成覆蓋率報告
mvn test jacoco:report
```

### 步驟 3: 啟動服務

```bash
# 方式 1: 使用 Maven 運行
mvn spring-boot:run

# 方式 2: 使用 JAR 文件運行
mvn clean package -DskipTests
java -jar target/metadata-service-0.0.1-SNAPSHOT.jar
```

### 步驟 4: 測試 API 端點

```bash
# 測試健康檢查
curl http://localhost:8081/actuator/health

# 上傳收據元數據
curl -X POST "http://localhost:8081/api/metadata/receipts" \
  -F "invoiceNo=TEST-001" \
  -F "purchaseDate=2023-10-24" \
  -F "amount=1000.00" \
  -F "itemName=Test Item" \
  -F "ownerAddress=0x1234567890123456789012345678901234567890"

# 驗證元數據哈希
curl "http://localhost:8081/api/metadata/hash?url=ipfs://<metadata_url>"
```

### 步驟 5: 查看 API 文檔

```bash
# 訪問 Swagger UI
open http://localhost:8081/swagger-ui.html
```

## 🎯 核心概念

### 什麼是元數據服務？

TAR 元數據服務負責管理和存儲 TAR 收據的元數據，提供：

- **元數據存儲**: 安全存儲收據的詳細信息
- **哈希驗證**: 確保元數據的完整性和不可篡改性
- **可插拔存儲**: 支持 S3 和 IPFS 存儲後端
- **REST API**: 提供標準化的 API 接口

### 主要功能

- **上傳元數據**: 接收並存儲收據元數據
- **哈希計算**: 計算元數據的 SHA-256 哈希
- **哈希驗證**: 驗證元數據的完整性
- **文件下載**: 下載存儲的文件

## 🔧 常用操作

### 1. 上傳收據元數據

```bash
curl -X POST "http://localhost:8081/api/metadata/receipts" \
  -F "invoiceNo=INV-2023-001" \
  -F "purchaseDate=2023-10-24" \
  -F "amount=5000.00" \
  -F "itemName=台北101辦公室" \
  -F "ownerAddress=0x1234567890123456789012345678901234567890" \
  -F "image=@office.jpg"
```

**回應**:

```json
{
  "metadataUrl": "ipfs://abc123-def456-ghi789",
  "metaHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
}
```

### 2. 驗證元數據哈希

```bash
curl "http://localhost:8081/api/metadata/hash?url=ipfs://abc123-def456-ghi789"
```

**回應**:

```json
{
  "metaHash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
}
```

### 3. 下載文件

```bash
curl "http://localhost:8081/api/metadata/download?key=metadata/metadata_INV-001_uuid.json"
```

## 📊 實際使用場景

### 場景 1: 房地產收據元數據

```json
{
  "invoiceNo": "RE-2023-001",
  "purchaseDate": "2023-10-24",
  "amount": 50000000,
  "itemName": "台北101辦公室",
  "ownerAddress": "0x1234567890123456789012345678901234567890",
  "imageUrl": "ipfs://office-image-hash",
  "timestamp": 1698105600000
}
```

### 場景 2: 藝術品收據元數據

```json
{
  "invoiceNo": "ART-2023-001",
  "purchaseDate": "2023-10-24",
  "amount": 1000000,
  "itemName": "蒙娜麗莎複製品",
  "ownerAddress": "0x1234567890123456789012345678901234567890",
  "imageUrl": "ipfs://artwork-image-hash",
  "timestamp": 1698105600000
}
```

### 場景 3: 奢侈品收據元數據

```json
{
  "invoiceNo": "LUX-2023-001",
  "purchaseDate": "2023-10-24",
  "amount": 500000,
  "itemName": "勞力士手錶",
  "ownerAddress": "0x1234567890123456789012345678901234567890",
  "imageUrl": "ipfs://watch-image-hash",
  "timestamp": 1698105600000
}
```

## 🛠️ 開發工具

### 1. 使用 Makefile

```bash
# 查看所有可用命令
make help

# 運行測試
make test

# 構建應用程式
make build

# 運行應用程式
make run

# Docker 部署
make docker-run
```

### 2. 使用 Maven 命令

```bash
# 編譯專案
mvn compile

# 運行測試
mvn test

# 打包應用程式
mvn package

# 運行應用程式
mvn spring-boot:run

# 清理專案
mvn clean
```

### 3. 使用 Docker

```bash
# 構建 Docker 映像
docker build -t metadata-service .

# 運行容器
docker run -p 8081:8081 metadata-service

# 使用 Docker Compose
docker-compose up -d
```

## 🔍 故障排除

### 常見問題

#### 1. 端口被占用

```bash
# 檢查端口使用情況
lsof -i :8081

# 停止占用端口的進程
kill -9 <PID>
```

#### 2. Java 版本問題

```bash
# 檢查 Java 版本
java -version

# 需要 Java 17 或更高版本
# 如果版本不符，請安裝正確的 Java 版本
```

#### 3. Maven 依賴問題

```bash
# 清理並重新下載依賴
mvn clean install

# 強制更新依賴
mvn clean install -U
```

#### 4. 存儲配置問題

```bash
# 檢查配置文件
cat src/main/resources/application.yml

# 確保存儲類型配置正確
# app.storage.type: ipfs  # 或 s3
```

### 調試技巧

#### 1. 啟用詳細日誌

```yaml
# 在 application.yml 中添加
logging:
  level:
    com.tar.metadata: DEBUG
    org.springframework.web: DEBUG
```

#### 2. 使用健康檢查

```bash
# 檢查應用程式狀態
curl http://localhost:8081/actuator/health

# 查看詳細健康信息
curl http://localhost:8081/actuator/health | jq
```

#### 3. 監控 API 請求

```bash
# 使用 curl 的詳細模式
curl -v -X POST "http://localhost:8081/api/metadata/receipts" \
  -F "invoiceNo=TEST-001" \
  -F "purchaseDate=2023-10-24" \
  -F "amount=1000.00" \
  -F "itemName=Test Item" \
  -F "ownerAddress=0x1234567890123456789012345678901234567890"
```

## 📚 學習資源

### 1. 基礎概念

- [Spring Boot 官方文檔](https://spring.io/projects/spring-boot)
- [REST API 設計指南](https://restfulapi.net/)
- [JSON 格式規範](https://www.json.org/)

### 2. 開發工具

- [Maven 官方文檔](https://maven.apache.org/guides/)
- [Docker 官方文檔](https://docs.docker.com/)
- [curl 使用指南](https://curl.se/docs/)

### 3. 安全最佳實踐

- [Spring Security 指南](https://spring.io/guides/topicals/spring-security-architecture)
- [API 安全最佳實踐](https://owasp.org/www-project-api-security/)

## 🎯 下一步

### 1. 集成其他服務

- **Smart Contract Service**: 集成智能合約服務
- **Backend Core API**: 集成後端核心 API
- **Verification Service**: 集成驗證服務

### 2. 配置生產環境

```bash
# 複製環境變量模板
cp env.sample .env

# 編輯環境變量
# 配置 S3 或 IPFS 存儲
# 設置安全配置
```

### 3. 監控和維護

- 設置應用程式監控
- 配置日誌聚合
- 定期備份元數據

## 🆘 獲取幫助

### 1. 查看文檔

- `README.md` - 完整使用指南
- `API_DOCUMENTATION.md` - API 參考文檔
- `快速入門.md` - 本文件

### 2. 運行測試

```bash
# 運行所有測試
mvn test

# 運行特定測試
mvn test -Dtest=MetadataServiceTest
```

### 3. 檢查日誌

```bash
# 查看應用程式日誌
tail -f app.log

# 查看 Maven 構建日誌
mvn spring-boot:run -X
```

---

**恭喜！您已經成功設置了 TAR 元數據服務。現在可以開始管理您的代幣化資產元數據了！**






