# TAR 收據合約服務 - 快速入門指南

## 🚀 5 分鐘快速開始

### 步驟 1: 環境準備

```bash
# 進入專案目錄
cd "1.Smart Contract Service"

# 安裝依賴
npm install
```

### 步驟 2: 運行測試

```bash
# 運行所有測試
npm run test

# 查看測試覆蓋率
npm run coverage
```

### 步驟 3: 本地部署

```bash
# 啟動本地節點（新終端）
npx hardhat node

# 部署合約（另一個終端）
npm run deploy:local
```

### 步驟 4: 設置發行者

```bash
npm run set-issuer
```

### 步驟 5: 鑄造第一個 TAR 收據

```bash
npm run mint
```

### 步驟 6: 驗證收據

```bash
npm run verify
```

## 🎯 核心概念

### 什麼是 TAR 收據？

TAR (Tokenized Asset Receipt) 收據是一種基於區塊鏈的數字收據，用於證明對實物資產的所有權或權益。每個收據都是唯一的 NFT，包含：

- **元數據**: 資產的詳細信息
- **哈希驗證**: 確保元數據完整性
- **撤銷機制**: 必要時可撤銷收據
- **版稅支持**: 支持創作者版稅

### 主要角色

- **管理員 (Admin)**: 合約所有者，可管理角色和暫停合約
- **發行者 (Issuer)**: 可鑄造和撤銷 TAR 收據
- **持有者 (Holder)**: 擁有 TAR 收據的用戶

## 🔧 常用操作

### 1. 鑄造 TAR 收據

```typescript
// 準備元數據
const metadata = {
  name: "房地產收據 #1",
  description: "台北市信義區豪宅收據",
  image: "https://example.com/image.jpg",
  attributes: [
    { trait_type: "位置", value: "台北市信義區" },
    { trait_type: "面積", value: "100坪" },
    { trait_type: "價值", value: "5000萬台幣" },
  ],
};

// 計算元數據哈希
const metadataHash = ethers.keccak256(
  ethers.toUtf8Bytes(JSON.stringify(metadata))
);

// 鑄造收據
const tx = await tarReceipt.mint(
  buyerAddress,
  "https://example.com/metadata/1",
  metadataHash
);
```

### 2. 驗證 TAR 收據

```typescript
// 驗證收據
const isValid = await tarReceipt.verify(tokenId, metadataHash);

if (isValid) {
  console.log("✅ TAR 收據有效");
} else {
  console.log("❌ TAR 收據無效");
}
```

### 3. 撤銷 TAR 收據

```typescript
// 撤銷收據
const tx = await tarReceipt.revoke(tokenId);
console.log("收據已撤銷");
```

## 📊 實際使用場景

### 場景 1: 房地產代幣化

```typescript
// 房地產收據
const realEstateMetadata = {
  name: "台北101辦公室收據",
  description: "台北101大樓第50層辦公室所有權證明",
  image: "https://example.com/taipei101.jpg",
  attributes: [
    { trait_type: "建築物", value: "台北101" },
    { trait_type: "樓層", value: "50樓" },
    { trait_type: "面積", value: "200坪" },
    { trait_type: "價值", value: "1億台幣" },
  ],
};
```

### 場景 2: 藝術品代幣化

```typescript
// 藝術品收據
const artworkMetadata = {
  name: "蒙娜麗莎收據",
  description: "達文西蒙娜麗莎畫作所有權證明",
  image: "https://example.com/monalisa.jpg",
  attributes: [
    { trait_type: "藝術家", value: "達文西" },
    { trait_type: "年份", value: "1503-1519" },
    { trait_type: "材質", value: "油畫" },
    { trait_type: "價值", value: "8億美元" },
  ],
};
```

### 場景 3: 奢侈品代幣化

```typescript
// 奢侈品收據
const luxuryMetadata = {
  name: "勞力士手錶收據",
  description: "勞力士 Submariner 手錶所有權證明",
  image: "https://example.com/rolex.jpg",
  attributes: [
    { trait_type: "品牌", value: "勞力士" },
    { trait_type: "型號", value: "Submariner" },
    { trait_type: "材質", value: "不鏽鋼" },
    { trait_type: "價值", value: "50萬台幣" },
  ],
};
```

## 🛠️ 開發工具

### 1. 使用 Makefile

```bash
# 查看所有可用命令
make help

# 快速設置開發環境
make dev-setup

# 運行完整測試
make full-test

# 完整部署流程
make deploy-full
```

### 2. 使用 npm 腳本

```bash
# 編譯合約
npm run compile

# 運行測試
npm run test

# 生成覆蓋率報告
npm run coverage

# 部署到本地
npm run deploy:local

# 部署到 Sepolia
npm run deploy:sepolia
```

### 3. 直接使用 Hardhat

```bash
# 編譯
npx hardhat compile

# 測試
npx hardhat test

# 部署
npx hardhat run scripts/deploy.ts --network localhost

# 控制台
npx hardhat console --network localhost
```

## 🔍 故障排除

### 常見問題

#### 1. 編譯錯誤

```bash
# 清理並重新編譯
npx hardhat clean
npx hardhat compile
```

#### 2. 測試失敗

```bash
# 運行單個測試文件
npx hardhat test test/tarReceipt.spec.ts

# 運行特定測試
npx hardhat test --grep "Should mint token successfully"
```

#### 3. 部署失敗

```bash
# 檢查網路連接
npx hardhat node

# 檢查帳戶餘額
npx hardhat console --network localhost
> const [owner] = await ethers.getSigners()
> await ethers.provider.getBalance(owner.address)
```

#### 4. 權限錯誤

```bash
# 檢查角色
npx hardhat console --network localhost
> const tarReceipt = await ethers.getContractAt("TARReceipt", contractAddress)
> await tarReceipt.hasRole(await tarReceipt.ISSUER_ROLE(), issuerAddress)
```

### 調試技巧

#### 1. 啟用詳細日誌

```bash
# 運行測試時顯示詳細信息
npx hardhat test --verbose

# 部署時顯示詳細信息
npx hardhat run scripts/deploy.ts --network localhost --verbose
```

#### 2. 使用控制台

```bash
# 啟動 Hardhat 控制台
npx hardhat console --network localhost

# 在控制台中測試合約
> const [owner, issuer, buyer] = await ethers.getSigners()
> const TARReceipt = await ethers.getContractFactory("TARReceipt")
> const tarReceipt = await TARReceipt.deploy("TAR", "TAR", owner.address)
> await tarReceipt.mint(buyer.address, "https://example.com/1", "0x1234")
```

#### 3. 事件監聽

```typescript
// 監聽所有事件
tarReceipt.on("*", (event) => {
  console.log("事件:", event.event, event.args);
});

// 監聽特定事件
tarReceipt.on("Minted", (tokenId, to, metaHash) => {
  console.log(`代幣 ${tokenId} 已鑄造給 ${to}`);
});
```

## 📚 學習資源

### 1. 基礎概念

- [什麼是 NFT？](https://ethereum.org/zh/nft/)
- [ERC-721 標準](https://eips.ethereum.org/EIPS/eip-721)
- [智能合約基礎](https://ethereum.org/zh/developers/docs/smart-contracts/)

### 2. 開發工具

- [Hardhat 文檔](https://hardhat.org/docs)
- [ethers.js 文檔](https://docs.ethers.io/)
- [OpenZeppelin 文檔](https://docs.openzeppelin.com/)

### 3. 安全最佳實踐

- [Solidity 安全指南](https://consensys.github.io/smart-contract-best-practices/)
- [OpenZeppelin 安全指南](https://docs.openzeppelin.com/contracts/security)

## 🎯 下一步

### 1. 集成其他服務

- **Backend Core API**: 集成後端 API 服務
- **Metadata Service**: 集成元數據存儲服務
- **Verification Service**: 集成驗證服務

### 2. 部署到測試網

```bash
# 配置環境變量
cp env.sample .env
# 編輯 .env 文件

# 部署到 Sepolia
npm run deploy:sepolia
```

### 3. 監控和維護

- 設置事件監聽
- 配置警報系統
- 定期安全審計

## 🆘 獲取幫助

### 1. 查看文檔

- `README_CN.md` - 中文使用指南
- `技術文檔.md` - 詳細技術文檔
- `API參考.md` - 完整 API 參考

### 2. 運行測試

```bash
# 運行所有測試
npm run test

# 生成覆蓋率報告
npm run coverage
```

### 3. 檢查日誌

```bash
# 查看部署日誌
npm run deploy:local

# 查看測試日誌
npm run test --verbose
```

---

**恭喜！您已經成功設置了 TAR 收據合約服務。現在可以開始開發您的代幣化資產應用程序了！**

